{"ast":null,"code":"import _taggedTemplateLiteral from\"C:/Users/nilss/Desktop/Drill Maker/20241211-Lacross-Drill-Maker/lacross-drill-maker/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5;import{useRef,useState,useEffect,useCallback}from\"react\";import styled from\"styled-components\";import jsPDF from\"jspdf\";import{useBeforeunload}from\"react-beforeunload\";import Paper from\"./paper.js\";import VariantSwitcher from\"./VariantSwitcher\";import Toolbar from\"./Toolbar\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function App(_ref){let{mode,showForm,showDownloadButtons,showExportImportButtons,formInputClass,buttonClass,onChange,defaultData,defaultLogo,promptBeforeUnload}=_ref;const canvasRef=useRef();const importDataRef=useRef();const importLogoRef=useRef();const[initialized,setInitialized]=useState(canvasRef.current);const[activeVariant,setActiveVariant]=useState();const[activeTool,setActiveTool]=useState(mode.toolbars[0][0]);const[activeToolColor,setActiveToolColor]=useState(\"black\");const[canvasJSON,setCanvasJSON]=useState();const[title,setTitle]=useState(\"\");const[description,setDescription]=useState(\"\");const[changed,setChanged]=useState(false);const[showEraseButton,setShowEraseButton]=useState(false);const[logo,setLogo]=useState(defaultLogo);const touchDevice=(\"ontouchstart\"in window);const[paper,setPaper]=useState({});// Exports title, description, and canvas data as JSON.\nconst exportData=useCallback(()=>{return{title:title,description:description,canvas:canvasJSON};},[title,description,canvasJSON]);// Imports title, description, and canvas data from JSON.\nconst importData=useCallback((json,_canvas)=>{const imported=JSON.parse(json);const _paper=_canvas||paper;setTitle(imported.title);setDescription(imported.description);if(_paper.importJSON){_paper.importJSON(JSON.stringify(imported.canvas));}},[]);// Find and set active variant.\nconst findAndSetActiveVariant=useCallback((_canvas,_build)=>{const _paper=_canvas||paper;const _mode=_build||mode;let variant=_paper.findActiveVariant(_mode.variants);if(variant){setActiveVariant(variant);}},[]);// Downloads PNG.\nfunction handleDownloadImage(){let link=document.createElement(\"a\");link.download=(title||\"Drill\")+\".png\";link.href=canvasRef.current.toDataURL(\"image/png\");link.click();setChanged(false);}// Downloads PDF. Letter document is 8.5\"x11\", 72ppi (points per inch).\n// Fonts measured in points. X and Y measured in inches.\nfunction handleDownloadPDF(){const paperWidth=8.5;const paperHeight=11;const margin=.75;const contentWidth=paperWidth-margin-margin;const ppi=72;const logoHeight=1;const titleFontSize=24;const subheadingFontSize=16;const descriptionFontSize=10;const footerFontSize=10;const underlineHeight=2/ppi;let workingY=.5;const doc=new jsPDF({orientation:\"p\",unit:\"in\",format:\"letter\"});// Logo.\ndoc.addImage(mode.pdf.logo,paperWidth-margin-logoHeight,workingY,logoHeight,logoHeight);workingY+=logoHeight+.25;// Title section.\nif(title){// Title.\ndoc.setFontSize(titleFontSize);doc.text(doc.splitTextToSize(title,contentWidth),margin,workingY,{baseline:\"top\"});workingY+=titleFontSize/ppi+5/ppi;// Title underline.\ndoc.setLineWidth(underlineHeight);doc.setDrawColor(37,62,86);doc.line(margin,workingY,paperWidth-margin,workingY);workingY+=underlineHeight+.25;}// Canvas image.\nconst imageHeight=contentWidth*mode.ratio;doc.addImage(canvasRef.current,\"PNG\",margin,workingY,contentWidth,imageHeight);workingY+=imageHeight+.25;// Description section.\nif(description){// Subheading.\ndoc.setFontSize(subheadingFontSize);doc.text(\"Description\",margin,workingY,{baseline:\"top\"});workingY+=subheadingFontSize/ppi+5/ppi;// Subheading underline.\ndoc.setLineWidth(underlineHeight);doc.setDrawColor(37,62,86);doc.line(margin,workingY,paperWidth-margin,workingY);workingY+=underlineHeight+.25;// Description.\ndoc.setFontSize(descriptionFontSize);doc.text(doc.splitTextToSize(description,contentWidth),margin,workingY,{baseline:\"top\",lineHeightFactor:1.4});}// Footer.\ndoc.setFontSize(footerFontSize);doc.text(mode.pdf.footer,paperWidth/2,paperHeight-margin,{baseline:\"bottom\",align:\"center\"});doc.save((title||\"Drill\")+\".pdf\");setChanged(false);}// Downloads JSON.\nfunction handleExport(){let link=document.createElement(\"a\");link.download=(title||\"Drill\")+\".json\";link.href=\"data:application/json;charset=utf-8,\"+encodeURIComponent(JSON.stringify(exportData()));link.click();setChanged(false);}// Imports JSON data and empties file input for next import.\nfunction handleImportData(){let reader=new FileReader();reader.onload=event=>importData(event.target.result);reader.readAsText(importDataRef.current.files[0]);importDataRef.current.value=null;}// Imports logo image and empties file input for next import.\nfunction handleImportLogo(){let reader=new FileReader();reader.onload=event=>setLogo(event.target.result);reader.readAsDataURL(importLogoRef.current.files[0]);importLogoRef.current.value=null;}// Erases drawing.\nfunction handleErase(){if(window.confirm(\"Are you sure you want to erase this drawing? This cannot be undone.\")){paper.erase();}}// Initializes paper.js. Do this after page finishes loading to ensure that\n// the responsive canvas is the correct size.\nuseEffect(()=>{function initialize(){var newPaper=new Paper();setPaper(newPaper);newPaper.init(canvasRef.current,mode.strokeWidth,setCanvasJSON);setInitialized(true);}if(document.readyState===\"complete\"){initialize();}else{window.addEventListener('load',initialize);}},[mode.strokeWidth]);// Activates tool.\nuseEffect(()=>{if(initialized){paper.activateTool(activeTool.tool,activeTool.props||{},activeToolColor,activeTool.icon);}},[initialized,activeTool,activeToolColor,paper]);// Tracks whether or not the canvas is changed. Executes onChange prop after\n// stuff changes. If everything is in its initial state, then send null\n// values.\nuseEffect(()=>{const _changed=initialized&&(title||description||!paper.isEmpty());if(onChange){if(_changed){onChange(exportData(),canvasRef.current.toDataURL(\"image/png\"),canvasRef.current);}else{onChange(null,null,canvasRef.current);}}setChanged(_changed);},[initialized,onChange,title,description,exportData]);// Imports default data.\nuseEffect(()=>{if(initialized){if(defaultData){importData(defaultData,paper);}findAndSetActiveVariant(paper,mode);}},[initialized,defaultData,importData]);// Changes background image.\nuseEffect(()=>{if(initialized&&activeVariant){paper.setBackground(activeVariant.background,activeVariant.logo,mode.logo,logo,activeVariant.name);}},[initialized,activeVariant,mode,logo,paper]);// Tracks whether or not to show the erase button.\nuseEffect(()=>{setShowEraseButton(initialized&&!paper.isEmpty());},[initialized,exportData]);// Prompt user before leaving if component's state is changed.\nuseBeforeunload(event=>{if(changed&&promptBeforeUnload){return\"Are you sure you want to leave this page? You may lose unsaved changes.\";}});return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(VariantSwitcher,{mode:mode,activeVariant:activeVariant,onVariantChange:variant=>setActiveVariant(variant)}),/*#__PURE__*/_jsx(Canvas,{ratio:mode.ratio,className:\"drill-maker__canvas\",children:/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,keepalive:\"true\",resize:\"true\",onMouseEnter:()=>{paper.setActive&&paper.setActive();}})}),touchDevice&&/*#__PURE__*/_jsx(ActiveToolDescription,{className:\"drill-maker__active-tool-description\",children:activeTool.name}),/*#__PURE__*/_jsx(Toolbar,{toolbars:mode.toolbars,activeTool:activeTool,onToolChange:tool=>setActiveTool(tool),colors:mode.colors,activeToolColor:activeToolColor,onToolColorChange:color=>setActiveToolColor(color),onUndo:()=>{paper.undo();},onRedo:()=>{paper.redo();}}),showForm&&/*#__PURE__*/_jsxs(Form,{className:\"drill-maker__form\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:title,onChange:event=>setTitle(event.target.value),placeholder:\"Drill Title Here\",className:formInputClass}),/*#__PURE__*/_jsx(\"textarea\",{value:description,onChange:event=>setDescription(event.target.value),placeholder:\"Drill description here\",className:formInputClass,rows:\"4\"})]}),(showDownloadButtons||showExportImportButtons||showEraseButton)&&/*#__PURE__*/_jsxs(Actions,{className:\"drill-maker__actions\",children:[showDownloadButtons&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleDownloadImage,type:\"button\",className:buttonClass,children:\"Download PNG\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleDownloadPDF,type:\"button\",className:buttonClass,children:\"Download PDF\"})]}),showExportImportButtons&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleExport,type:\"button\",className:buttonClass,children:\"Export\"}),/*#__PURE__*/_jsx(ImportInput,{ref:importDataRef,type:\"file\",accept:\"application/json\",id:\"drill-maker-import-data\",onChange:handleImportData}),/*#__PURE__*/_jsx(\"label\",{className:buttonClass,htmlFor:\"drill-maker-import-data\",children:\"Import\"}),/*#__PURE__*/_jsx(ImportInput,{ref:importLogoRef,type:\"file\",accept:\"image/*\",id:\"drill-maker-import-logo\",onChange:handleImportLogo}),/*#__PURE__*/_jsx(\"label\",{className:buttonClass,htmlFor:\"drill-maker-import-logo\",children:\"Import Logo\"})]}),showEraseButton&&/*#__PURE__*/_jsx(\"button\",{onClick:handleErase,type:\"button\",className:buttonClass,children:\"Erase Drawing\"})]})]});}const Canvas=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  position: relative;\\n  display: block;\\n  width: 100%;\\n  padding: 0;\\n  overflow: hidden;\\n  margin-bottom: 16px;\\n\\n  &:before {\\n    display: block;\\n    content: \\\"\\\";\\n    padding-top: \",\"%;\\n  }\\n\\n  canvas {\\n    position: absolute;\\n    top: 0;\\n    bottom: 0;\\n    left: 0;\\n    width: 100%;\\n    height: 100%;\\n    border: 0;\\n  }\\n\"])),props=>props.ratio*100);const Form=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  margin-top: 16px;\\n\\n  input, textarea {\\n    margin-bottom: 16px;\\n  }\\n\"])));const ActiveToolDescription=styled.div(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  text-align: center;\\n  font-family: Roboto, Arial, sans-serif;\\n  font-size: 16px;\\n  line-height: 20px;\\n  margin-bottom: 8px;\\n\"])));const Actions=styled.div(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  margin-top: 12px;\\n  text-align: center;\\n\\n  button, label {\\n    margin: 8px 4px 0;\\n  }\\n\"])));const ImportInput=styled.input(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  visibility: hidden;\\n  width: 0;\\n  height: 0;\\n\"])));export default App;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}